# Image API v2.0 æ–‡æ¡£

Image API v2.0 æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„å›¾ç‰‡åˆ†å‘æœåŠ¡ï¼Œæ”¯æŒè®¾å¤‡è‡ªé€‚åº”ã€æœ¬åœ°å­˜å‚¨ä¸æ•°æ®åº“å¤–é“¾æ··åˆæ¨¡å¼ã€‚è¯¥ç‰ˆæœ¬åŸºäºæ•°æ®åº“é©±åŠ¨ï¼Œæä¾›æ›´ä¸°å¯Œçš„å›¾ç‰‡å…ƒæ•°æ®è¿”å›ã€‚

## åŸºæœ¬ä¿¡æ¯

- **APIç‰ˆæœ¬**: 2.0
- **è¯·æ±‚æ–¹å¼**: GET
- **å“åº”æ ¼å¼**: JSON (é»˜è®¤) / TEXT / é‡å®šå‘
- **æ”¯æŒæ ¼å¼**: JPEG, PNG, GIF, WebP, AVIF

## æ ¸å¿ƒç‰¹æ€§

- ğŸ“± **è®¾å¤‡è‡ªé€‚åº”**: è‡ªåŠ¨æ£€æµ‹ç§»åŠ¨ç«¯/æ¡Œé¢ç«¯ UAï¼Œè¿”å›å¯¹åº”æ¯”ä¾‹çš„å›¾ç‰‡ã€‚
- âš¡ **åŸç”Ÿåˆ†å‘**: ç›´æ¥åˆ†å‘åŸå§‹ä¸Šä¼ æ ¼å¼ï¼ˆå«é€æ˜ PNG å’ŒåŠ¨æ€ GIFï¼‰ï¼Œä¸è¿›è¡ŒäºŒæ¬¡å¤„ç†ã€‚
- ğŸŒ **æ··åˆå­˜å‚¨**: æ”¯æŒæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨ä¸æ•°æ®åº“å¤–é“¾ï¼ˆExternalï¼‰æ¨¡å¼åˆ‡æ¢ã€‚
- ğŸ—„ï¸ **ç»“æ„å…¼å®¹**: å®Œç¾å…¼å®¹æ‰å¹³åŒ–ç›®å½•ç»“æ„åŠæ—§ç‰ˆæœ¬çš„æ ¼å¼å­ç›®å½•ç»“æ„ã€‚

## è¯·æ±‚åœ°å€

```
GET /image_api.php
```

## è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
| :--- | :--- | :--- | :--- | :--- |
| `count` | integer | å¦ | `1` | è¿”å›å›¾ç‰‡çš„æ•°é‡ã€‚æ”¯æŒèŒƒå›´ï¼š1 - 50ã€‚ |
| `type` | string | å¦ | `(è‡ªåŠ¨æ£€æµ‹)` | ç›®æ ‡è®¾å¤‡ç±»å‹ï¼š`pc` (æ¡Œé¢ç«¯) / `pe` (ç§»åŠ¨ç«¯)ã€‚ç•™ç©ºåˆ™ç”±ç³»ç»Ÿæ ¹æ® User-Agent è‡ªåŠ¨è¯†åˆ«ã€‚ |
| `format` | string | å¦ | `json` | **å“åº”æ•°æ®æ ¼å¼**ï¼š`json` (é»˜è®¤) / `text` (çº¯æ–‡æœ¬ URL åˆ—è¡¨) / `url` (ç­‰åŒäº text)ã€‚ |
| `return` | string | å¦ | `json` | **è¿”å›è¡Œä¸ºæ§åˆ¶**ï¼š`json` (è¿”å›æ•°æ®å¯¹è±¡) / `redirect` (ç›´æ¥é‡å®šå‘åˆ°å›¾ç‰‡ï¼Œä»…å½“ `count=1` æ—¶æœ‰æ•ˆ)ã€‚ |
| `external` | boolean | å¦ | `false` | **å­˜å‚¨æ¨¡å¼**ï¼š`true` æˆ– `1` (è·å–å¤–é“¾å›¾ç‰‡) / `false` æˆ– `0` (è·å–æœ¬åœ°åº“å›¾ç‰‡)ã€‚ |

---

## ä½¿ç”¨æ¨¡å¼

### 1. æœ¬åœ°æ¨¡å¼ (Default)

ä»æœåŠ¡å™¨çš„ `images` ç›®å½•éšæœºè·å–å›¾ç‰‡ã€‚

#### ç›®å½•ç»“æ„
```
images/
â”œâ”€â”€ pc/          # æ¡Œé¢ç«¯/æ¨ªå±å›¾ç‰‡ (jpg, png, gif, webp, avif)
â””â”€â”€ pe/          # ç§»åŠ¨ç«¯/ç«–å±å›¾ç‰‡ (jpg, png, gif, webp, avif)
```

#### è¯·æ±‚ç¤ºä¾‹
```bash
# è·å–1å¼ éšæœºå›¾ç‰‡ (è‡ªåŠ¨è¯†åˆ«è®¾å¤‡)
GET /image_api.php

# è·å–5å¼  PC ç«¯å›¾ç‰‡ (JSON æ ¼å¼)
GET /image_api.php?count=5&type=pc

# è·å–ç§»åŠ¨ç«¯å›¾ç‰‡å¹¶ç›´æ¥è·³è½¬åˆ°åŸå›¾
GET /image_api.php?type=pe&return=redirect
```

### 2. å¤–é“¾æ¨¡å¼ (External)

ä»æ•°æ®åº“ `images` è¡¨ä¸­è·å– `storage_type='external'` çš„éšæœºå›¾ç‰‡ã€‚

#### è¯·æ±‚ç¤ºä¾‹
```bash
# ä»å¤–é“¾åº“è·å–1å¼ å›¾ç‰‡
GET /image_api.php?external=true

# ä»å¤–é“¾åº“è·å–3å¼ ç§»åŠ¨ç«¯å›¾ç‰‡çš„ URL åˆ—è¡¨
GET /image_api.php?external=true&type=pe&count=3&format=text
```

---

## å“åº”æ ¼å¼

### JSON å“åº” (é»˜è®¤)

```json
{
  "success": true,
  "count": 1,
  "type": "pc",
  "mode": "random",
  "total_available": 1,
  "timestamp": 1704556800,
  "api_version": "2.0",
  "return_type": "json",
  "external_mode": false,
  "user_agent": "Mozilla/5.0...",
  "images": [
    {
      "id": 1,
      "filename": "abc123.png",
      "url": "http://localhost/images/2024/01/06/abc123.png",
      "extension": "png",
      "type": "pc",
      "format": "png",
      "width": 1920,
      "height": 1080,
      "size": 102455,
      "tags": null,
      "description": null,
      "upload_time": "2024-01-06 12:00:00",
      "external": false,
      "storage_type": "local",
      "converted": false
    }
  ]
}
```

### TEXT å“åº”

å½“ `format=text` æ—¶ï¼Œæ¯è¡Œè¿”å›ä¸€ä¸ª URLï¼š

```text
http://example.com/images/pc/pic1.jpg
http://example.com/images/pc/pic2.png
```

---

## é”™è¯¯å¤„ç†

### é”™è¯¯å“åº”

```json
{
  "success": false,
  "message": "æ²¡æœ‰æ‰¾åˆ°å›¾ç‰‡ï¼Œè¯·æ£€æŸ¥ images ç›®å½•",
  "count": 0,
  "images": []
}
```

---

## æŠ€æœ¯å»ºè®®

1.  **ç›´æ¥å¼•ç”¨**ï¼šå¯¹äºä¸ªäººåšå®¢èƒŒæ™¯æˆ–éšæœºå£çº¸ï¼Œæ¨èä½¿ç”¨ `return=redirect` å‚æ•°ç›´æ¥ä½œä¸º `<img>` æ ‡ç­¾çš„ `src`ã€‚
2.  **CDN é…åˆ**ï¼šå»ºè®®å°† `images/` ç›®å½•æŒ‚è½½åˆ° CDN ä¸‹ï¼Œä»¥è·å¾—æé€Ÿä½“éªŒã€‚
3.  **PNG ä¼˜åŒ–**ï¼šè™½ç„¶ç³»ç»Ÿæ”¯æŒ PNGï¼Œä½†è‹¥å¯¹åŠ è½½é€Ÿåº¦æœ‰æç«¯è¦æ±‚ï¼Œå»ºè®®ä¸Šä¼ å‰å…ˆè¿›è¡Œå‹ç¼©ã€‚

---
**Image API v2.0** - ä¿æŒçº¯ç²¹ï¼Œè¿½æ±‚æè‡´å“åº”ã€‚
